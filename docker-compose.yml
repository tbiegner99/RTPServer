version: "3.3"
services:
  rtsp_server:
    build: .
    restart: always
    container_name: rtsp
    environment:
      - VIDEO_PATH: '/mnt/kareoke/video'
      - KAREOKE_PATH: '/mnt/kareoke/Songs'
      - HTTP_PORT: '8001'
      - RTSP_PORT: '4586'
      - PLAYLIST_SERVER_URL: 'http://kareoke-client:8080'
      - PLACEHOLDER_VIDEO: '/mnt/kareoke/placeholder/discoball10.mp4'
    ports:
      - 4586:4586
      - 8001:8001
    depends_on:
      - playlist

  ui:
    build: ./ui
    restart: always
    container_name: router
    depends_on:
      - playlist

    volumes:
      - ./ui/nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./ui/build:/srv/package/cah
      - ./ui/nginx/certs:/etc/letsencrypt/live
      - ./ui/nginx/data/certbot/conf:/etc/letsencrypt
      - ./ui/nginx/data/certbot/www:/var/www/certbot
    ports:
      - 80:80
      - 443:443
    user: root
